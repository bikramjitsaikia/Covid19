<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>All Users - Covid 19 India</title>
	<link rel="stylesheet" type="text/css"
		href="webjars/bootstrap/css/bootstrap.min.css" />
	<link rel="stylesheet" type="text/css"
		href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css">
	<link rel="stylesheet" type="text/css"
		href="https://cdn.datatables.net/select/1.3.3/css/select.dataTables.min.css">
	<script type="text/javascript"
		src="https://code.jquery.com/jquery-3.6.0.js"></script>
	<script type="text/javascript"
		src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
	<script type="text/javascript"
		src="https://cdn.datatables.net/select/1.3.3/js/dataTables.select.min.js"></script>
	<script type="text/javascript"
		src="https://code.highcharts.com/highcharts.js"></script>
</head>
<body class="bg-dark">
	<div th:replace="~{nav_fragments/user_nav :: user_nav}"></div>

	<div class="container">
		<div class="row align-items-center pt-5">
			<div class="col  pr-40" id="col-pie-active">
			</div>
			<div class="col  pr-40" id="col-pie-recovered">
			</div>
		</div>
		<div class="row align-items-center pt-5">
			<div class="col" id="col-pie-death">
			</div>
			<div class="col" id="col-pie-confirmed">
			</div>
		</div>
	</div>
	<script th:inline="javascript">
		$(document).ready(function () {
			// Make monochrome colors
			function pieColors(color) {
			    var colors = [],
			        base = String(color),
			        i;
			
			    for (i = 0; i < 3; i += 1) {
			        // Start out with a darkened base color (negative brighten), and end
			        // up with a much brighter color
			        colors.push(Highcharts.color(base).brighten((i - 3) / 7).get());
			    }
			    return colors;
			}
		 	var chartVal = {
		 		backgroundColor: '#201818',
		        plotBackgroundColor: null,
		        plotBorderWidth: null,
		        plotShadow: false,
		        type: 'pie'
		    };
		    var tooltipVal = {
		        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
		    };
		    var accessVal = {
		        point: {
		            valueSuffix: '%'
		        }
		    };
		    function plotVals(color) {
		        var plotStr = {
		        	pie: {
			            allowPointSelect: true,
			            cursor: 'pointer',
			            colors: pieColors(color),
			            dataLabels: {
			                enabled: true,
			                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
			                color: 'white',
			            }
			        }
			    };
		        return plotStr;
		    }
		    
		    Highcharts.chart("col-pie-active", {
			    chart: chartVal,
			    title: {
			        text: 'Statewise by active cases',
			        style: {
			        	color: '#ffffff'
			        }
			    },
			    tooltip: tooltipVal,
			    accessibility: accessVal,
			    plotOptions: plotVals('#faff33'),
		        series: [
			            {
			                data: pieData("active"),
			            },
			        ],
		    });
		 
		    Highcharts.chart("col-pie-death", {
			    chart: chartVal,
			    title: {
			        text: 'Statewise by death cases',
			        style: {
			        	color: '#ffffff'
			        }
			    },
			    tooltip: tooltipVal,
			    accessibility: accessVal,
			    plotOptions: plotVals('#ff4b33'),
		        series: [
			            {
			                data: pieData("deaths"),
			            },
			        ],
		    });

		    Highcharts.chart("col-pie-recovered", {
			    chart: chartVal,
			    title: {
			        text: 'Statewise by recovered cases',
			        style: {
			        	color: '#ffffff'
			        }
			    },
			    tooltip: tooltipVal,
			    accessibility: accessVal,
			    plotOptions: plotVals('#33ff33'),
		        series: [
			            {
			                data: pieData("recovered"),
			            },
			        ],
		    });

		    Highcharts.chart("col-pie-confirmed", {
			    chart: chartVal,
			    title: {
			        text: 'Statewise by confirmed cases',
			        style: {
			        	color: ' #ffffff '
			        }
			    },
			    tooltip: tooltipVal,
			    accessibility: accessVal,
			    plotOptions: plotVals('#ffffff'),
		        series: [
			            {
			                data: pieData("confirmed"),
			            },
			        ],
		    });
		});
		 
		function pieData(index) {
		    var data = [];
		    var states = /*[[${states}]]*/ null;
			var highest = 0;
			if (states == null)
				return null;
    		for (i = 0; i < states.length; i++) {
    			highest = Math.max(parseFloat(states[i][String(index)]), highest);
    		}
    		for (i = 0; i < states.length; i++) {
				var stateName = states[i].state;
				if (stateName == "Total")
					continue;
				var num = parseFloat(states[i][String(index)]);
				if (num == highest) {
					data.push({name: stateName, y: num, sliced: true, selected: true});
				} else {
					data.push({name: stateName, y: num});
				}
			}
			return data;
		}
    </script>
</body>
</html>